<!DOCTYPE html>
<html lang="en">
  <head>
      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-125893749-1"></script>
      <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-125893749-1');
          </script>
    <title>Haskell Documentation with Haddock: Wishes'n'Tips :: Kowainik</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Kowainik ‚Äî A comprehensive guide for documentation with Haddock in Haskell">
    <meta name="keywords" content="Haskell, Functional progarmming, FP , haskell, documentation, guide ">
    <meta name="author" content="Kowainik  ‚Äî Veronika Romashkina <> Dmitrii Kovanikov " />

    <!-- Twitter cards -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@kowainik" />
    <meta property="twitter:title" content="Kowainik - Haskell Documentation with Haddock: Wishes'n'Tips" />
    <meta name="twitter:description" content="A comprehensive guide for documentation with Haddock in Haskell" />
    <meta name="twitter:image:src" content="https://kowainik.github.io/images/logo-yellow.png" />
    <meta property="og:title" content="Kowainik - Haskell Documentation with Haddock: Wishes'n'Tips" />
    <meta property="og:description" content="A comprehensive guide for documentation with Haddock in Haskell" />
    <meta property="og:site_name" content="Kowainik" />
    <meta property="og:image" content="https://kowainik.github.io/images/logo-yellow.png" />

    <!-- Favicon -->
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/dracula.min.css" />
    <!-- Fontawesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <!-- Custom fonts for this template -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Lato" />
    <!-- Custom styles for this template -->
    <link href="../css/default.css" rel="stylesheet">
    <link href="../css/post.css" rel="stylesheet">
  </head>

  <body class="body-posts">

          <!-- Header -->
      <nav class="navbar navbar-inverse navbar-fixed-left leftmenu bg-primary text-secondary">
            <div class="navbar-header">
                <div class="postslogo"> <a class="navbar-brand" href="../"><img class="img-fluid" src="../images/logo-tr.png" alt="Kowainik"></a></div>

            </div>
            <div class="align-self-center">
                <a class="btn btn-primary rounded-pill" href="https://ko-fi.com/kowainik" target="_blank">
                    <i class="fas fa-coffee"></i> Buy a coffee
                </a>
            </div>

            <div class="toc-zone">
                <h6 class="coolFont">Contents</h6>
                <div class="toc" id="main">
                    <ul>
<li><a href="#what-is-haddock">What is Haddock</a>
<ul>
<li><a href="#comment-to-document">Comment to Document</a></li>
<li><a href="#what-can-be-documented">What can be documented</a></li>
</ul></li>
<li><a href="#haddock-fishing">Haddock Fishing</a>
<ul>
<li><a href="#top-level">Top Level</a>
<ul>
<li><a href="#top-level-header-info">Top-level header info</a></li>
<li><a href="#top-level-module-documentation">Top level module documentation</a></li>
</ul></li>
<li><a href="#arrange-export-lists">Arrange export lists</a>
<ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#named-doc-chunks">Named doc chunks</a></li>
<li><a href="#exports-best-practices">Exports best practices</a></li>
</ul></li>
<li><a href="#import-only-modules">Import only modules</a></li>
<li><a href="#tables">Tables</a></li>
<li><a href="#ascii-as-documentation-art">ASCII as documentation art</a></li>
<li><a href="#expandable-examples">Expandable examples</a></li>
<li><a href="#doctest">Doctest</a></li>
</ul></li>
<li><a href="#small-haddock-baits">Small Haddock baits</a>
<ul>
<li><a href="#module-links-functions-links-etc.">Module links, functions links etc.</a></li>
<li><a href="#anchors">Anchors</a></li>
<li><a href="#since"><span class="citation" data-cites="since">@since</span></a></li>
<li><a href="#escaping">Escaping</a>
<ul>
<li><a href="#challenge-time">Challenge time!</a></li>
</ul></li>
<li><a href="#fixity-of-operators">Fixity of operators</a></li>
<li><a href="#haddock-cpp">Haddock + CPP</a></li>
<li><a href="#cabal-and-haddock-syntax">.cabal and Haddock syntax</a></li>
</ul></li>
<li><a href="#haddock-cli-commands">Haddock CLI commands</a>
<ul>
<li><a href="#haddock-warnings">Haddock warnings</a></li>
</ul></li>
<li><a href="#wishes">Wishes</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#links">Links</a></li>
<li><a href="#meme-shelf">Meme shelf</a></li>
</ul>
                </div>
            </div>
            <div class="coolFont">
                <div>Date: December  7, 2020</div>
                

                <div class="author">Author: Veronika Romashkina <> Dmitrii Kovanikov</div>
                <div class="row tag-block">
                
                <span class="tag-block"> <a class="btn btn-outline-dark btn-tag" href="../tags/haskell">haskell</a></span>
                
                <span class="tag-block"> <a class="btn btn-outline-dark btn-tag" href="../tags/documentation">documentation</a></span>
                
                <span class="tag-block"> <a class="btn btn-outline-dark btn-tag" href="../tags/guide">guide</a></span>
                
                </div>

                <div class="allposts">
                    <h3><a href="../posts"> Posts =<< </a></h3>
                </div>
            </div>
      </nav>
      <div class="container info">
          <h2 class="text-center text-uppercase text-secondary">Haskell Documentation with Haddock: Wishes'n'Tips</h2>
          <div class="content">
          <div class="row post">
              <div class="col-12 post-body">
              <p class="lead">
                  <p>Haskell has a stigma of having poor or no documentation at all. Though more and more maintainers are doing a hell of a job to improve the quality of their libraries and applications, it is still not enough. We need to strengthen our vision of documentation collectively and as a consequence, master the existing tools for doing that.</p>
<p>There are <a href="https://documentation.divio.com/">different types of documentation</a>. Today we want to talk about API and libraries documentation inside your library, and accordingly about Haskell gear for that ‚Äì <a href="https://www.haskell.org/haddock/">Haddock</a>.</p>
<p>The blog post is going to give Haddock overview, suggest documentation best practices, reveal the specialities of the Haddock tool, and show-and-tell lots of different examples of how to squeeze more out of your documentation. It should be interesting to library maintainers, developers who want to improve their documenting skills and everyone interested in documentation techniques in Haskell.</p>
<h2 id="what-is-haddock">What is Haddock<a href="#what-is-haddock" class="anchor">üîó</a></h2>
<p>Haddock is the Haskell way to document exposed API of your library or application. Writing special comments alongside your code helps to keep code and documentation synchronised and up-to-date (as outdated documentation is a painful problem to deal with). It also makes the docs comfy both for maintainers and users. And Haddock provides precisely that. Haskell is not always beginner-friendly, so giving a helping hand to users of your code in a convenient way is greatly appreciated.</p>
<p>You write documentation using the special Haddock markup language right near the structures you want to document, and it can be rendered to different formats, including styled HTML, that could be viewable later on <a href="http://hackage.haskell.org/">Hackage</a>, <a href="https://www.stackage.org/">Stackage</a> or even locally. Moreover, if you upload your library to Hackage or Stackage, <a href="https://hoogle.haskell.org/">Hoogle</a> will search for definitions by name or type across all packages, including yours.</p>
<p>Here is how a typical Haddock documentation page for a module looks like:</p>
<figure>
<img src="../images/haddock/haddock-membrain.png" alt /><figcaption>Haddock Module Example</figcaption>
</figure>
<p>To produce the documentation, Haddock needs to build the project first because it uses build-time information. But you don‚Äôt need to worry about it usually, because build tools do that automatically when you ask them to output documentation.</p>
<h3 id="comment-to-document">Comment to Document<a href="#comment-to-document" class="anchor">üîó</a></h3>
<p>Haddock is written in Haskell comments with the special annotations. There are two types of Haddock marked comments ‚Äì <strong>pre-</strong> (starting with the <code>|</code> symbol) and <strong>post-comments</strong> (starting with the <code>^</code> symbol), which means that Haddock comments could be put right before or after the function/type/class definitions.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="co">-- | I am the 'foo' function's Haddock pre-comment.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="ot">foo ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="ot">bar ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="co">-- ^ I am the 'bar' function's Haddock post-comment</span></span></code></pre></div>
<p>For multi-line Haddock comments you can use either <strong>per-line</strong> or <strong>block</strong> style comments for both pre and post types. The special Haddock symbol needs to be added just to the first line of the multi-line comment, and Haddock will consume following lines until the first non-comment line.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="co">-- | This is multiline</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="co">-- per-line Haddock pre-comment</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="ot">foo ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a><span class="ot">bar ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="co">-- ^ Another per-line Haddock</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a><span class="co">-- post-comment</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a><span class="co">{- | Multiline Haddock</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a><span class="co">block pre-comment</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a><span class="co">-}</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a><span class="ot">baz ::</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Text</span></span></code></pre></div>
<p>If you write multi-line comments in your code, we strongly advise using <strong>block</strong> comments by default over per-line ones because of the number of reasons:</p>
<ul>
<li><p>There are fewer chances to lose part of your documentation due to the extra newline with multiline comments syntax, unlike per-line comments. Remember, that Haddock consumes comments marked as documentation until the first non-comment line, and a newline without <code>--</code> separates such comments into ordinary independent groups.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="co">-- | I am a normal line of documentation.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="co">-- I will be in the docs too.</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="co">-- I am not going to make it due to the missing @--@ in the previous line.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="ot">foo ::</span> <span class="dt">Int</span></span></code></pre></div></li>
<li><p>As a consequence, it‚Äôs impossible to have conditional documentation chunks under the <a href="https://guide.aelve.com/haskell/cpp-vww0qd72">C Preprocessor (CPP)</a> pragmas when using the <code>--</code> style of comments, as CPP pragmas are stripped to empty lines.</p></li>
<li><p>Multiline comments contain less noise (no <code>--</code> on each line), making it easier to read and update.</p></li>
<li><p>They are more suitable for inserting/copying/updating code snippets quickly.</p></li>
<li><p>They also occupy less space horizontally on average, because you don‚Äôt waste 3 characters on each line.</p></li>
</ul>
<h3 id="what-can-be-documented">What can be documented<a href="#what-can-be-documented" class="anchor">üîó</a></h3>
<p>Generally, Haddock documents the exposed API of your Haskell libraries and applications.</p>
<p>More specifically, Haddock can be applied to document the following parts of the Haskell code:</p>
<ul>
<li>Top-level module headers</li>
<li>Type definitions: <code>data</code>, <code>type</code> and <code>newtype</code></li>
<li>Constructors and fields</li>
<li>Typeclasses ‚Äî <code>class</code> declarations</li>
<li>Typeclasses methods</li>
<li>Instances</li>
<li>Derived typeclasses</li>
<li>Top-level functions</li>
<li>Arguments and return results of functions</li>
<li>More exotic top-level definitions: <code>pattern</code>, <code>type family</code>, <code>data family</code>, <code>type instance</code> and <code>data instance</code></li>
</ul>
<p>The below example showcases some Haddock syntax and features:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="co">{- | Our example sum type.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="co">__Examples:__</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="op">@</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>empty <span class="ot">=</span> <span class="dt">'Empty'</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>full <span class="ot">=</span> <span class="dt">'CharCode'</span> <span class="dv">42</span> \'a\'</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a><span class="op">@</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a><span class="op">-</span>}</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a><span class="kw">data</span> <span class="dt">CharWithInt</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>    <span class="ot">=</span> <span class="dt">Empty</span> <span class="co">-- ^ First constructor</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a>      <span class="co">-- | Second constructor</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a>    <span class="op">|</span> <span class="dt">CharCode</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a>        <span class="dt">Int</span> <span class="co">-- ^ first field of 'CharCode'</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a>        <span class="dt">Char</span> <span class="co">-- ^ second field of 'CharCode'</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a>    <span class="kw">deriving</span> stock</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a>        ( <span class="dt">Show</span>  <span class="co">{- ^ Derived to show.</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true"></a><span class="co">                 @since 0.1.0.0</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true"></a><span class="co">                -}</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true"></a>        , <span class="dt">Eq</span>  <span class="co">-- ^ Derived to check for equality</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true"></a>        )</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true"></a><span class="co">{- | Type class to eject some fields from the data types.</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true"></a><span class="co">@since 0.0.0.0</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true"></a><span class="co">-}</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true"></a><span class="kw">class</span> <span class="dt">Eject</span> a <span class="kw">where</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true"></a>   <span class="ot">{-# MINIMAL getInt #-}</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true"></a>   <span class="co">-- | Get 'Int' if applicable.</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true"></a>   getInt</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true"></a><span class="ot">       ::</span> a  <span class="co">-- ^ The whole data type.</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true"></a>       <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Int</span>  <span class="co">-- ^ Result. 'Nothing' if no 'Int' in data type.</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true"></a>   <span class="co">-- | Get 'Char' if applicable.</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true"></a><span class="ot">   getChar ::</span> a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Char</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true"></a><span class="co">-- | The instance for our sum type written manually</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true"></a><span class="kw">instance</span> <span class="dt">Eject</span> <span class="dt">CharWithInt</span> <span class="kw">where</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true"></a><span class="ot">    getInt ::</span> <span class="dt">CharWithInt</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Int</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true"></a>    getInt <span class="dt">Empty</span>          <span class="ot">=</span> <span class="dt">Nothing</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true"></a>    getInt (<span class="dt">CharCode</span> i _) <span class="ot">=</span> <span class="dt">Just</span> i</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true"></a><span class="ot">    getChar ::</span> <span class="dt">CharWithInt</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Char</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true"></a>    <span class="fu">getChar</span> <span class="dt">Empty</span>          <span class="ot">=</span> <span class="dt">Nothing</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true"></a>    <span class="fu">getChar</span> (<span class="dt">CharCode</span> _ c) <span class="ot">=</span> <span class="dt">Just</span> c</span></code></pre></div>
<p>When documentation is built, it will look like on the screenshot below:</p>
<figure>
<img src="../images/haddock/haddock-overall-example.png" alt /><figcaption>Haddock Overall Example</figcaption>
</figure>
<hr class="fish">
<p>We don‚Äôt recommend using the Haddock comment syntax for other places where they cannot be applied by specification because this breaks Haddock. Even though the documentation states that such comments should be ignored, it is not what you would get on the output.</p>
<p>For example, the following innocent-looking Haddock results in the documentation error:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="ot">var ::</span> <span class="dt">Int</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>var <span class="ot">=</span> <span class="dv">42</span> <span class="co">-- ^ The answer</span></span></code></pre></div>
<pre class="shell"><code>Haddock coverage:

src/BlogpostHaddock.hs:57:10: error:
    parse error on input '-- ^ The answer'
   |
57 | var = 42 -- ^ The answer
   |          ^^^^^^^^^^^^^^^
</code></pre>
<p>This issue will prevent the documentation appearing at Hackage and Stackage, which means that users won‚Äôt be able to read package documentation easily or search by the package in Hoogle.</p>
<p>Correct documentation looks like this:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="ot">var ::</span> <span class="dt">Int</span> <span class="co">-- ^ The answer</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>var <span class="ot">=</span> <span class="dv">42</span></span></code></pre></div>
<p>If you wanted to leave an ordinary (non-documentation) comment:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="ot">var ::</span> <span class="dt">Int</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>var <span class="ot">=</span> <span class="dv">42</span> <span class="co">-- The answer</span></span></code></pre></div>
<hr class="fish">
<p>We are not going to cover all annotation syntax. You can learn more from the <a href="https://haskell-haddock.readthedocs.io/en/latest/index.html">official documentation</a>. Instead, we will try to focus on best practices, advice and more explanation of suitability and usability of some various pieces of documentation on different levels.</p>
<h2 id="haddock-fishing">Haddock Fishing<a href="#haddock-fishing" class="anchor">üîó</a></h2>
<p>As most of us are looking at the libraries‚Äô documentation through Hackage/Stackage/Haddock or local options of the same format, we are going to cover each layer of the documentation on the page piece by piece from top to bottom and see how we can use 100% of each element.</p>
<p>Every page is responsible for one Haskell module and correspondingly reflects its structure, though in a user-configurable way (we will cover later the ways to take control over that). So, with respect to that, let‚Äôs start diving into the meaning of each and every documentation piece.</p>
<div class="exercise">
<p>Though, sometimes you are interested only in specific types and functions, not in reading the full documentation. Hackage helps here as well. You can press the <kbd>s</kbd> button on a package page to quickly jump to definitions.</p>
<figure>
<img src="../images/haddock/haddock-relude-search.png" alt /><figcaption>Haddock Search Example</figcaption>
</figure>
</div>
<h3 id="top-level">Top Level<a href="#top-level" class="anchor">üîó</a></h3>
<p>First thing you see on the module documentation page is this:</p>
<figure>
<img src="../images/haddock/haddock-top-level-header.png" alt /><figcaption>Haddock top-level header</figcaption>
</figure>
<p>This whole information is taken from the top-level Haddock comment for the module. The comment is attached to the <code>module</code> construction in the source file. You can put extensions (<code>{-# LANGUAGE ... #-}</code>) and options (e.g.¬†<code>{-# OPTIONS_GHC ... #-}</code>) either <em>before</em> the module header comment or <em>after</em>, but we recommend putting module Haddock comment closer to the module keyword itself, <strong>after</strong> all language extensions and module-specific options.</p>
<p>So the module layout may look like this:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="ot">{-# LANGUAGE ScopedTypeVariables #-}</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="ot">{-# LANGUAGE TypeApplications    #-}</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a><span class="co">{- | ... Module header comment</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a><span class="co">-}</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a><span class="kw">module</span> <span class="dt">MyModule</span> (<span class="op">...</span>) <span class="kw">where</span></span></code></pre></div>
<h4 id="top-level-header-info">Top-level header info<a href="#top-level-header-info" class="anchor">üîó</a></h4>
<p>The meta-information in the border to the right is the result of special annotations at the beginning of the top-level Haddock. If it isn‚Äôt present in the file, then none will be shown in there (except for automatically determined info by the tool you are using).</p>
<p>These annotations include the following information:</p>
<ul>
<li><code>Module</code> ‚Äì Module name</li>
<li><code>Description</code> ‚Äì Short description</li>
<li><code>Copyright</code> ‚Äì Copyright note (preserves newlines)</li>
<li><code>License</code> or <code>Licence</code> or <code>SPDX-License-Identifier</code> ‚Äì the name of the license used in the project</li>
<li><code>Maintainer</code> ‚Äì information about current maintainer, can include email</li>
<li><code>Stability</code> ‚Äì <em>experimental</em> or <em>stable</em></li>
<li><code>Portability</code> ‚Äì <em>portable</em> or <em>non-portable</em>, but you can put anything basically. This field meaning is not strictly defined. Some people use it for OS-portability and write something like POSIX, Windows, portable. Other people mean ‚Äúthe Haskell compiler according to standard portability‚Äù and put ‚Äúnon-portable‚Äù here if a module uses GHC-only extensions.</li>
</ul>
<p>Auto-filled, no manual fill-in is possible:</p>
<ul>
<li><code>Safe Haskell</code> ‚Äì <code>Safe</code>, <code>Trustworthy</code>, <code>Unsafe</code> or <code>None</code> (default)</li>
<li><code>Language</code> ‚Äì Haskell report: 98 or 2010</li>
</ul>
<p>All of the fields are optional, in free format and don‚Äôt have any requirements. Adding this header to each module is advisable.</p>
<blockquote>
<p>üë©‚Äçüè´ You can use the <a href="https://github.com/vaclavsvejcar/headroom">headroom</a> tool to create and update module headers automatically.</p>
</blockquote>
<hr class="fish">
<p>Additionally, you can put a special Haddock pragma <code>{-# OPTIONS_HADDOCK show-extensions #-}</code> at the top of your module before the documentation to also display all extensions enabled in this module. This feature can be helpful to quickly give an overview of required GHC features to work with the module API.</p>
<figure>
<img src="../images/haddock/haddock-extensions.png" alt /><figcaption>Haddock Extensions for the module</figcaption>
</figure>
<h4 id="top-level-module-documentation">Top level module documentation<a href="#top-level-module-documentation" class="anchor">üîó</a></h4>
<p>The top-level module documentation is the first thing people see when they open a module. So it should describe the module exhaustively and set the mood of what to expect from it.</p>
<p>Because of that, we believe that It should describe clearly all necessary information, and must have the following:</p>
<ul>
<li>Top-level module header</li>
<li>General high-level overview of the API</li>
<li>Explanations on when to use and when not to use the module</li>
<li>Usage examples</li>
<li>If there are special requirements on how this module should (not) be imported, it must be clearly stated</li>
</ul>
<p>The top-level documentation is not attached to any particular function or type. That‚Äôs why it gives an excellent opportunity to describe general concepts, draw the big picture, compare different options and provide an overall summary without diving into details of each entity of the module.</p>
<h3 id="arrange-export-lists">Arrange export lists<a href="#arrange-export-lists" class="anchor">üîó</a></h3>
<p>Types and functions appear in the documentation according to the order they are specified in the export list of each module. It is good to mention now that in Haskell, exports of the module can be written explicitly in the <code>module</code> construction manually. Though, Haskell also allows you not to specify export lists at all. In this case, it is considered that such a module exports every function, type, etc. that it has.</p>
<p>Considering this, we can state that <strong>it is crucial to write your exports explicitly</strong>. Doing so gives you control not only over exported content but also over the documentation layout, which is quite as important. A clear export list helps to have more predictable documentation output where you can structure the information the way you want, aside from other benefits.</p>
<p>When users read the module documentation for the first time, they most likely browse the page scrolling from top to bottom. This fact should be taken into consideration when you start customising the structure of the export list, so you can put accents on the most important parts and make it comfortable to look through.</p>
<h4 id="table-of-contents">Table of Contents<a href="#table-of-contents" class="anchor">üîó</a></h4>
<p>One of the improvements that could help users navigate your documentation easily is having a structured Table of Contents (ToC) for the module. It can be done in Haddock using the <a href="https://haskell-haddock.readthedocs.io/en/latest/markup.html#documentation-structure-examples">Sectioning feature</a>.</p>
<p>Here is an example of how such detail could improve the understanding of your module. From just a look at the Contents of the main <code>Prolens</code> module of the <a href="https://hackage.haskell.org/package/prolens">prolens</a> library we already can have an idea of the different interfaces that it provides, such as Lenses, Prisms and Traversals); And the structure guides about where to look for functions or operators related to the particular concept.</p>
<figure>
<img src="../images/haddock/haddock-prolens-toc.png" alt /><figcaption>Haddock ToC</figcaption>
</figure>
<hr class="fish">
<p>To organise your documentation like that, you can use <a href="https://haskell-haddock.readthedocs.io/en/latest/markup.html#section-headings">Sections Headings</a> with the <code>*</code> symbols. You can also add the inline description of the sections which will be shown in the section before the documentation for each element in there.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="kw">module</span> <span class="dt">Json</span> <span class="kw">where</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>    ( <span class="co">-- * Types</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>    , <span class="dt">JsonType</span> (<span class="op">..</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>      <span class="co">-- * Decoders</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>      <span class="co">--</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>      <span class="co">-- | How to decode standard types</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>      <span class="co">-- ** Textual</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a>    , textDecoder</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a>    <span class="op">...</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>    )</span></code></pre></div>
<figure>
<img src="../images/haddock/haddock-our-toc-view.png" alt /><figcaption>Haddock ToC</figcaption>
</figure>
<h4 id="named-doc-chunks">Named doc chunks<a href="#named-doc-chunks" class="anchor">üîó</a></h4>
<p>ToC works fabulously for your documentation. You can notice that each section‚Äôs inline description can potentially contain a lot of useful information and be quite agglomerated because of that. However, it quickly can become messy and make the header of the module repulsive for the developers and maintainers themselves. It can even prevent maintainers from writing descriptions full of important details and explanations to the grouped elements only not to mix documentation and code. Haddock has a solution for this: <a href="https://haskell-haddock.readthedocs.io/en/latest/markup.html#named-chunks">named documentation chunks</a>.</p>
<p>This feature allows putting the whole documentation block in a separate place and then referring to it by name.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="kw">module</span> <span class="dt">Json</span> <span class="kw">where</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>    ( <span class="co">-- * Types</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>      <span class="co">-- $type</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>    , <span class="dt">JsonType</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>      <span class="co">-- * Decoders</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>      <span class="co">-- $decoders</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>      <span class="co">-- ** Textual</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>      <span class="co">-- $text</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>    , textDecoder</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a>    <span class="op">...</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a>    )</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a><span class="op">...</span> <span class="dt">All</span> <span class="kw">module</span> content <span class="op">...</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a><span class="co">{- $type</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a><span class="co">This is a very long type description and explanation</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true"></a><span class="co">-}</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true"></a><span class="co">{- $decoders</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true"></a><span class="co">How decoders work</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true"></a><span class="co">-}</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true"></a><span class="co">{- $text</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true"></a><span class="co">Can even say about this group</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true"></a><span class="co">-}</span></span></code></pre></div>
<figure>
<img src="../images/haddock/haddock-named-chunks.png" alt /><figcaption>Haddock ToC</figcaption>
</figure>
<p>Though be aware that this feature allows using named chunks only in the export list, but not in the documentation for functions and types. It would be so much better if the scope of this feature would be expanded to all places where you can write Haddock comments! Admittedly, there‚Äôs an <a href="https://github.com/haskell/haddock/issues/97">open feature request</a> in Haddock about this.</p>
<h4 id="exports-best-practices">Exports best practices<a href="#exports-best-practices" class="anchor">üîó</a></h4>
<p>We want to share a few suggestions on how to write the best documentation for exports:</p>
<ul>
<li>Always write explicit and well-formatted (for your taste) export lists (e.g.¬†do not put everything on one line).</li>
<li>Put all relevant types before functions of those types. Lots of people actually read types to get the idea of how the interface is working.</li>
<li>Use sections and subsections.</li>
<li>Group sections logically (e.g.¬†group the Set type and Set functions in the same block, and Map type and Map functions in another).</li>
<li>It‚Äôs rarely better to sort exports alphabetically (unless you have functions that represent each alphabet letter). Though for some small chunks/sections of export, it doesn‚Äôt matter so much, so alphabetic order can be used there for ease.</li>
<li>Use named documentation chunks to provide more context for each group.</li>
</ul>
<p>All the above worked very well for us, and we recommend it to all libraries.</p>
<p>Here is a verbose example of the export list from the <a href="https://hackage.haskell.org/package/validation-selective">validation-selective</a> library:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="kw">module</span> <span class="dt">Validation</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a>    ( <span class="co">-- * Type</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a>      <span class="dt">Validation</span> (<span class="op">..</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a>      <span class="co">-- * How to use</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a>      <span class="co">-- $use</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a>      <span class="co">-- * Interface functions</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true"></a>    , isFailure</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true"></a>    , isSuccess</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true"></a>    , validation</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true"></a>    , failures</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true"></a>    , successes</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true"></a>    , partitionValidations</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true"></a>    , fromFailure</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true"></a>    , fromSuccess</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true"></a>      <span class="co">-- ** 'NonEmpty' combinators</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true"></a>      <span class="co">-- $nonEmptyCombinators</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true"></a>    , failure</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true"></a>    , failureIf</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true"></a>    , failureUnless</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true"></a>      <span class="co">-- ** 'Either' conversion</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true"></a>      <span class="co">-- $either</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true"></a>    , validationToEither</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true"></a>    , eitherToValidation</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true"></a>      <span class="co">-- * Combinators</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true"></a>    , validateAll</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true"></a>      <span class="co">-- ** When* functions</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true"></a>    , whenSuccess</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true"></a>    , whenFailure</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true"></a>    , whenSuccess_</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true"></a>    , whenFailure_</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true"></a>    , whenSuccessM</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true"></a>    , whenFailureM</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true"></a>    , whenSuccessM_</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true"></a>    , whenFailureM_</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true"></a>      <span class="co">-- ** 'Maybe' conversion</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true"></a>    , failureToMaybe</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true"></a>    , successToMaybe</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true"></a>    , maybeToFailure</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true"></a>    , maybeToSuccess</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true"></a>    ) <span class="kw">where</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true"></a></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true"></a><span class="op">...</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true"></a></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true"></a></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true"></a><span class="co">{- $use</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true"></a><span class="co">...</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true"></a><span class="co">-}</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true"></a></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true"></a><span class="co">{- $nonEmptyCombinators</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true"></a><span class="co">...</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true"></a><span class="co">-}</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true"></a></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true"></a><span class="co">{- $either</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true"></a><span class="co">...</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true"></a><span class="co">-}</span></span></code></pre></div>
<h3 id="import-only-modules">Import only modules<a href="#import-only-modules" class="anchor">üîó</a></h3>
<p>Often, when writing a library, you split it into multiple modules. When you structure your modules with specific implementation details in each, you usually can end up with the deep hierarchical structure, which in Haskell means long module names. For users‚Äô comfort, it‚Äôs desirable to provide shorter-named modules.</p>
<p>One of the standard things for library API is to create a special short-named module (ideally it should have the same name as your package for convenience) that imports other modules with all the essential API. Such import-only modules usually don‚Äôt contribute any new code. They serve the purpose of reexporting necessary library API and presenting it in a more digestible way.</p>
<p>We use this approach a lot in the <a href="https://hackage.haskell.org/package/tomland">tomland</a> library. We have several import-only modules there. The main <code>Toml</code> module reexports everything, so users need to write only a single import line <code>import qualified Toml</code> in order to have access to everything. Besides that, we also group logical modules into subgroups using imports-only super modules. Here is a short example of such a module:</p>
<figure>
<img src="../images/haddock/haddock-tomland-import-only.png" alt /><figcaption>Haddock Imports only module</figcaption>
</figure>
<p>We have a few tips on how to utilise documentation for such modules and make them shine maximally:</p>
<ul>
<li>Write the top-level description of the module, explaining what this group of reexported modules does and provide relevant examples.</li>
<li>You can rearrange reexported modules for better clarity to guide users through your API smoothly (you don‚Äôt need to export modules alphabetically).</li>
<li>Add named documentation chunks to provide the necessary context for each module import or each logical group (see <a href="#arrange-export-lists">exports arrangement section</a>).</li>
<li>Sometimes it‚Äôs better to reexport the whole module, sometimes only a few functions and list them explicitly in the export list. Use your judgement on how to present your API in the most convenient way for users.</li>
</ul>
<h3 id="tables">Tables<a href="#tables" class="anchor">üîó</a></h3>
<p>A lot of information can be conveyed greatly with tables! Here is a great example of textual types conversion functions from the <a href="https://github.com/kowainik/relude">relude</a> library presented as a table:</p>
<figure>
<img src="../images/haddock/haddock-relude-string.png" alt /><figcaption>Haddock Table</figcaption>
</figure>
<p>Tables in Haddock are grid-like tables where the layout is defined by ‚ÄúASCII art‚Äù. See the <a href="https://haskell-haddock.readthedocs.io/en/latest/markup.html#grid-tables">official documentation about tables</a> to learn about their syntax.</p>
<p>Despite bringing a lot of joy to users who read tables and people who love to create tables (guilty as charged), writing tables can be painful as the format is space- and layout-sensitive, so even any tiny change leads to the complete table restructure. You can use <a href="https://www.tablesgenerator.com/text_tables">this site</a> to create tables easier.</p>
<hr class="fish">
<p>In addition to having a challenging way to write tables and long debugging times, there are a few more facts. Whenever you have an idea for a suitable table in your documentation, to save you a lot of time, here is something to watch out for; we were caught on the following annoying Haddock bugs:</p>
<ul>
<li>If you write a table directly after the header section, it won‚Äôt be rendered because of the <a href="https://github.com/haskell/haddock/issues/801">Haddock bug</a>.</li>
<li>You may want to put tables not only in Haddock, but also in your README, but Hackage <a href="https://github.com/haskell/hackage-server/issues/565">currently doesn‚Äôt render</a> tables from markdown README files.</li>
</ul>
<h3 id="ascii-as-documentation-art">ASCII as documentation art<a href="#ascii-as-documentation-art" class="anchor">üîó</a></h3>
<p>The goal of the documentation is to give a comprehensive picture to your user and/or folk working on the same project. Therefore, it makes sense to use any accessible option to make use of any tool at your elbow. One of the versatile yet straightforward instruments is a graphical representation of some ideas of the function via ASCII.</p>
<p>Here are a few examples of ASCII-ar documentation in the wild.</p>
<figure>
<img src="../images/haddock/haddock-ascii-prolens.png" alt /><figcaption>Haddock ASCII Example 1</figcaption>
</figure>
<p>You can see that the diagram is simple, but it has a significant effect on understanding the type and what each part of it is responsible for.</p>
<figure>
<img src="../images/haddock/haddock-ascii-border.png" alt /><figcaption>Haddock ASCII Example 2</figcaption>
</figure>
<p>Here it is used to showcase the rendered output of borders in TUI.</p>
<p>Use your imagination to figure out what else could be done with ASCII, but it is clearly one of the easiest instruments that helps improve the documentation.</p>
<p>Moreover, if you want to easily draw some arrows, diagrams and so on with ASCII, there are even plenty of online tools which could help to handle it easily.</p>
<hr class="fish">
<p>It is fair to mention that Haddock does <a href="https://haskell-haddock.readthedocs.io/en/latest/markup.html?highlight=image#images">support images</a> as part of the documentation. And there are a bunch of use cases for that. You can see how useful it is for the rendering libraries, like <a href="https://hackage.haskell.org/package/reanimate">reanimate</a>:</p>
<figure>
<img src="../images/haddock/haddock-reanimate-gif.gif" alt /><figcaption>Haddock Gif Example</figcaption>
</figure>
<p>However, we do not suggest using the images feature heavily. The reason for that is that such documentation is not that stable when you develop a package. But as we know, Haddock is the instrument not only for users but for suppliers as well. Also, documentation has a burden of maintenance, you should keep that up-to-date, and there is no automatic way of that. Reasonably, it is not applicable if you are writing an image library, but even in that case, it would be great to have some mechanism to test images on obsolescence. However, in cases of simple schemes and anything doable with ASCII, it is better to prefer the latter.</p>
<h3 id="expandable-examples">Expandable examples<a href="#expandable-examples" class="anchor">üîó</a></h3>
<p>We think that the examples are the essential, and probably the most valuable, part of the documentation. Examples could be different:</p>
<ul>
<li>The function usage example, which clarifies how the function is mostly used</li>
<li>An example of the situation where the function can be used</li>
<li>Illustrations of some corner cases</li>
<li>The GHCi examples that show how the function behaves on the different inputs</li>
</ul>
<p>Though usage samples are valuable, sometimes they require a lot of preliminary explanations and context. That is why some examples could be massive and can contain a lot of text and code. In order to not pile up the precious documentation page, independent examples and use-cases can be put in a special expandable section of the Haddock comment. The syntax is the following:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="co">{- |</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a><span class="co">==== __Examples__</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a><span class="dt">Now</span> you see me</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a><span class="op">&gt;&gt;&gt;</span> foo <span class="op">+</span> bar <span class="dv">1</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a><span class="dv">53</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a><span class="op">-</span>}</span></code></pre></div>
<p>By default, Haddock hides such sections, but you can expand it by clicking on the triangle ‚ñ∂ icon:</p>
<figure>
<img src="../images/haddock/haddock-expandable-example.gif" alt /><figcaption>Haddock Expandable Example</figcaption>
</figure>
<p>This feature gives implementers more flexibility and control over the on-page appearance of the module. It helps to prioritise information and provide a compact way to fit the vital information, putting some additional parts outside. With this feature, you can provide necessary details only to users who are interested in specifics of some functions. And other people can quickly scroll past these irrelevant details.</p>
<h3 id="doctest">Doctest<a href="#doctest" class="anchor">üîó</a></h3>
<p>The main curse of the documentation is that it becomes obsolete with time if not maintained properly. Haddock decided to help developers with this problem by putting the documentation near the code itself so that you can update both at the same time. But that is not the only helper for Haskell in the wild. What about tests for your documentation?</p>
<p><a href="https://hackage.haskell.org/package/doctest">doctest</a> is an invaluable tool for <strong>testing</strong> your documentation. We mentioned earlier that providing examples to functions is super helpful. But having proof, that examples are not outdated and work as advertised, is even better!</p>
<p>Doctest is a Haskell library that performs testing of code snippets from your documentation. To do this, you need to prefix each example with triple arrows <code>&gt;&gt;&gt;</code> from the line start and write the expected output (if any) on the next line. Like so:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="co">{- | Monadic version of 'unless'.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; unlessM (pure False) $ putTextLn &quot;No text :(&quot;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a><span class="co">No text :(</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; unlessM (pure True) $ putTextLn &quot;Yes text :)&quot;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a><span class="co">-}</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a><span class="ot">unlessM ::</span> <span class="dt">Monad</span> m <span class="ot">=&gt;</span> m <span class="dt">Bool</span> <span class="ot">-&gt;</span> m () <span class="ot">-&gt;</span> m ()</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a>unlessM p m <span class="ot">=</span> p <span class="op">&gt;&gt;=</span> <span class="fu">flip</span> unless m</span></code></pre></div>
<p>And then, if you implement the doctest test-suite, the tool will check your code and error on any discrepancies.</p>
<p>As this is another test suite, it could be checked during the CI/CD process and all errors due to the outdated doc examples could be caught before the release.</p>
<p><strong><em>We strongly recommend using doctest for your code as much as you can!</em></strong></p>
<h2 id="small-haddock-baits">Small Haddock baits<a href="#small-haddock-baits" class="anchor">üîó</a></h2>
<p>The previous section explains some high-level and general recommendations. This section, in turn, provides smaller tips and tricks to improve the look and feel of your documentation.</p>
<h3 id="module-links-functions-links-etc.">Module links, functions links etc.<a href="#module-links-functions-links-etc." class="anchor">üîó</a></h3>
<p>Haddock allows linking to other exported definitions from documentation, and this is a powerful feature!</p>
<p>To link to some specific module, take into double quotes, like so:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="co">-- | This function works best with types from &quot;MyLibrary.MyModule&quot;.</span></span></code></pre></div>
<p>To link to some specific function or type, take it into single quotes:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a><span class="co">-- | Function 'foo' takes values of type 'MyType'.</span></span></code></pre></div>
<p>It is a really helpful feature because people who are not familiar with all types and functions can simply jump to definitions and read about them when necessary.</p>
<p>You can also use links (as well as other Haddock formatting) inside code blocks to make them look prettier. See the example below:</p>
<figure>
<img src="../images/haddock/haddock-tomland-links.png" alt /><figcaption>Haddock Tomland links</figcaption>
</figure>
<p>Here, we use keyword highlighting, module and functions links to make it more readable and help users to understand the example better.</p>
<h3 id="anchors">Anchors<a href="#anchors" class="anchor">üîó</a></h3>
<p>Haddock also allows you to mark anchors on the documentation page. You could link to them within the documentation with <code>#anchor</code> in the module or with <code>Module-Name.html#anchor</code> from other modules (<em>don‚Äôt believe the documentation, it lies</em>).</p>
<p>It could be quite handy in the situation where you can link to some broad explanation already covered somewhere in your docs, but applicable and helpful for the better understanding of a concrete function. For instance, like the following situation:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a><span class="co">{- |</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a><span class="co">...</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a><span class="co">#algorithm#</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a><span class="co">Algorithm description.</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a><span class="co">-}</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a><span class="op">...</span> some functions <span class="op">...</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a><span class="co">{- | The main algorithm runner.</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true"></a><span class="co">See [this description](#algorithm) for more details.</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true"></a><span class="co">-}</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true"></a><span class="ot">run ::</span> <span class="dt">IO</span> ()</span></code></pre></div>
<h3 id="since"><span class="citation" data-cites="since">@since</span><a href="#since" class="anchor">üîó</a></h3>
<p>Haddock supports special <code>@since</code> annotations that indicate the package version in which this <strong>type</strong>, <strong>function</strong>, <strong>argument</strong>, or even the whole <strong>module</strong> first appeared. This is invaluable information for users, as they can specify the library bounds more precisely depending on what functions they use and refer to the correct documentation, which corresponds to the interested version.</p>
<p>It looks like this in the code:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="co">{- | Decode JSON and return errors inside a list.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a><span class="co">@since 2.0.3.2</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a><span class="co">-}</span></span></code></pre></div>
<p>And then it will be visible in Haddock.</p>
<p>While developing, you might not know in advance what version will be next, because according to <a href="https://pvp.haskell.org/">PVP</a>, the next version number depends on the changes you perform. So, during the development mode, you can write <code>@since x.x.x.x</code> and then replace all such strings with the exact next version when it‚Äôs time to release the new version.</p>
<blockquote>
<p>üë©‚Äçüè´ If you are unsure what version should be next, tools like <a href="https://github.com/kowainik/policeman">policeman</a> can help with that.</p>
</blockquote>
<h3 id="escaping">Escaping<a href="#escaping" class="anchor">üîó</a></h3>
<p>Sometimes Haskell syntax and Haddock annotation syntax have some overlaps which make writing documentation for your functions a tough task. Specifically, some characters that are allowed to be in operator definitions, also have a different meaning for the Haddock tool. Because of that, you may have hard times seeing your documentation rendered incorrectly (especially if you notice that only after the release).</p>
<p>Haddock prints warnings for some errors when you build the documentation (e.g.¬†link to a non-existent type of function), but it doesn‚Äôt warn you if some documentation is not rendered correctly. So, you still need to check your generated docs and verify they look as expected.</p>
<p>For instance, you can‚Äôt simply write the Functor‚Äôs <code>fmap</code> operator as <code>&lt;$&gt;</code> in the documentation and expect it to give a link to the specified function. You need to escape symbols like this:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="co">{- | Use functor operator @\&lt;\$&gt;@</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a><span class="co">-}</span></span></code></pre></div>
<p>Though, if you link to it using single-quotes, you don‚Äôt need to escape characters, and you can even link operators inside parentheses (e.g.¬†<code>'(&lt;$&gt;')</code>) but this <a href="https://github.com/haskell/haddock/issues/951">wasn‚Äôt always the case</a>.</p>
<p>To see the entire rules set of escaping, you can check out what the <a href="https://haskell-haddock.readthedocs.io/en/latest/markup.html?highlight=escape#special-characters">official documentation says about it</a>.</p>
<section id="challenge-time" class="exercise">
<h4>Challenge time!<a href="#challenge-time" class="anchor">üîó</a></h4>
<p>Can you fix the following comment to make it look pretty when rendered?</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="co">{- | To use operators @(&lt;*&gt;)@ and 'Control.Category.(&gt;&gt;&gt;)',</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a><span class="co">enable extension {-# LANGUAGE RankNTypes #-}</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true"></a><span class="co">and export 'Lens\'' type. After that, you can do something like this:</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true"></a><span class="co">@</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true"></a><span class="co">set userL &quot;Alex&quot; myUser</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true"></a><span class="co">@</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true"></a><span class="co">-}</span></span></code></pre></div>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#solutionEscape" aria-expanded="false" aria-controls="solutionEscape">
Show solution
</button>
<div id="solutionEscape" class="solution collapse">
<p>Answer:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a><span class="co">{- | To use operators @'(&lt;*&gt;)'@ and '(Control.Category.&gt;&gt;&gt;)',</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a><span class="co">enable extension @\{\-\# LANGUAGE RankNTypes \#\-\}@</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a><span class="co">and export 'Lens'' type. After that, you can do something like this:</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a><span class="co">@</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true"></a><span class="co">'set' userL \&quot;Alex\&quot; myUser</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true"></a><span class="co">@</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true"></a><span class="co">-}</span></span></code></pre></div>
<p>A few notes:</p>
<ul>
<li>Escape or link operators with <code>&lt;</code> or <code>&gt;</code></li>
<li>Escape nested brackets, especially for language extensions</li>
<li>Use proper syntax for parenthesising operators</li>
<li>Remember proper escaping rules for single quotes</li>
<li>Escape string literals started with the uppercase to avoid unintentional linking to modules</li>
</ul>
</div>
</section>
<h3 id="fixity-of-operators">Fixity of operators<a href="#fixity-of-operators" class="anchor">üîó</a></h3>
<p>Operators in Haskell have <strong>precedence</strong> that tells the compiler how to group operations. Because of that, if you write <code>1 + 2 * 3</code> you get the result 7 and not 9 (or compiler error). If you don‚Äôt specify the fixity explicitly, it is set as <code>infixl 9</code> by default. But you can configure it by using the special Haskell syntax for that, e.g. <code>infix 5 .%</code> or <code>infixr 8 ^.^, *&amp;</code>. Haddock adds this information to the operators‚Äô documentation, so it is important to take care of it.</p>
<p>For older versions of Haddock, fixity annotations had a special meaning. When you tried to go to sources of your operator with custom fixity from the generated documentation (there is a useful <code>Sources</code> hyperlink in Haddock), you were sent to the fixity declaration, not to the operator definition itself. That is why it‚Äôs essential to put a fixity declaration before the operator. Also, you will have all information about the operator near each other. Like so:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="co">{- | This operator composes functions. It's similar to '.' but with</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a><span class="co">flipped arguments and arrows showing the direction of function</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a><span class="co">application. So the good old:</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true"></a><span class="co">@</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true"></a><span class="co">renderUserId :: User -&gt; Text</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true"></a><span class="co">renderUserId = truncate '.' render '.' userId</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true"></a><span class="co">@</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true"></a><span class="co">can be rewritten as</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true"></a><span class="co">@</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true"></a><span class="co">renderUserId :: User -&gt; Text</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true"></a><span class="co">renderUserId = userId '&gt;&gt;&gt;' render '&gt;&gt;&gt;' truncate</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true"></a><span class="co">@</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true"></a><span class="co">-}</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true"></a><span class="kw">infixr</span> <span class="dv">9</span> <span class="op">&gt;&gt;&gt;</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true"></a><span class="ot">(&gt;&gt;&gt;) ::</span> (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> (b <span class="ot">-&gt;</span> c) <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> c)</span></code></pre></div>
<blockquote>
<p>üë©‚Äçüî¨ If you use <a href="https://github.com/kowainik/Stan">Stan</a> (Haskell static analyser), it will warn you on missing explicit fixity declarations.</p>
</blockquote>
<h3 id="haddock-cpp">Haddock + CPP<a href="#haddock-cpp" class="anchor">üîó</a></h3>
<p>Some examples might work differently (or not work at all) on all operating systems and GHC versions. Because of this, you may want to test and show them conditionally by using the CPP Haskell extension. Unfortunately, when used straightforwardly, the combination of Haddock and CPP may not always work.</p>
<p>Specifically, CPP comments are stripped to empty lines during the phase of the compilation process, and parsed sources do not have irrelevant lines that are under a non-suitable case of CPP. And as such lines are empty, these comments don‚Äôt work with per-line comments:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a><span class="co">-- ‚òπÔ∏è incorrect</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a><span class="co">-- | A file path to document.</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a><span class="co">--</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true"></a><span class="pp">#ifdef mingw32_HOST_OS</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true"></a><span class="co">-- &gt;&gt;&gt; docPath</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true"></a><span class="co">-- C:\Documents\Doc.doc</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true"></a><span class="pp">#else</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true"></a><span class="co">-- &gt;&gt;&gt; docPath</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true"></a><span class="co">-- ~/Documents/doc</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true"></a><span class="pp">#endif</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true"></a><span class="ot">docPath ::</span> <span class="dt">String</span></span></code></pre></div>
<p>The solution for this case is simple ‚Äì use block multiline comments instead:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="co">-- üôÇ correct</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a><span class="co">{- | A file path to document.</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a><span class="co">#ifdef mingw32_HOST_OS</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; docPath</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true"></a><span class="co">C:\Documents\Doc.doc</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true"></a><span class="co">#else</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; docPath</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true"></a><span class="co">~/Documents/doc</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true"></a><span class="co">#endif</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true"></a><span class="co">-}</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true"></a><span class="ot">docPath ::</span> <span class="dt">String</span></span></code></pre></div>
<p>But generally watch out of such documentation blocks as the irrelevant information is not preserved after the compilation.</p>
<h3 id="cabal-and-haddock-syntax">.cabal and Haddock syntax<a href="#cabal-and-haddock-syntax" class="anchor">üîó</a></h3>
<p>Before, we were only speaking about single module-level documentation. But if you look at Hackage, you can see that the package itself contains a lot of meta-information.</p>
<p>All this information is provided through the project special files ‚Äì <code>.cabal</code> files ‚Äì that describe the package as it is.</p>
<p>Besides a lot of specific information, it contains the package description. Let us explain the relation: the <code>.cabal</code> description` uses Haddock like syntax, so you basically can use any of the Haddock element to put to the description of your package: tables, sections, code snippets, examples, anything, which gives a lot of opportunities to <em>‚Äúsell‚Äù</em> the package and show-off its capabilities straightaway.</p>
<p>Here are a few examples:</p>
<ul>
<li><a href="https://hackage.haskell.org/package/co-log-core">co-log-core</a></li>
<li><a href="https://hackage.haskell.org/package/tomland">tomland</a></li>
<li><a href="https://hackage.haskell.org/package/relude">relude</a></li>
</ul>
<p>See also, that each package have links to all exposed modules, and these pages look like we describe above.</p>
<h2 id="haddock-cli-commands">Haddock CLI commands<a href="#haddock-cli-commands" class="anchor">üîó</a></h2>
<p>Haddock is a CLI tool. It has several useful options that could be helpful in different situations. As we mentioned, we suggest using Haddock through the build tool of your choice. For example, to build the documentation locally with <code>cabal-install</code>, use the following command:</p>
<pre class="shell"><code>cabal haddock --enable-documentation</code></pre>
<p>Read more about other commands to generate and upload Haddock documentation in the following blog post:</p>
<ul>
<li><a href="https://vrom911.github.io/blog/haskell-aliases">Haskell Aliases</a></li>
</ul>
<h3 id="haddock-warnings">Haddock warnings<a href="#haddock-warnings" class="anchor">üîó</a></h3>
<p>When you build the documentation, Haddock also reports useful statistics:</p>
<ul>
<li>Documentation coverage</li>
<li>Functions with missing documentation</li>
<li>Errors in documentation (broken links to functions, ambiguous references, etc.)</li>
</ul>
<p>The output looks like this:</p>
<figure>
<img src="../images/haddock/haddock-warnings.png" alt /><figcaption>Haddock Warnings</figcaption>
</figure>
<p>It doesn‚Äôt report all the problems you may have with rendering, so we still recommend <strong>checking your documentation before each release</strong>.</p>
<h2 id="wishes">Wishes<a href="#wishes" class="anchor">üîó</a></h2>
<p>Haddock is a fantastic tool! You can already improve the quality of your documentation significantly by using existing Haddock features. But even Haddock itself can be improved a lot to allow writing even juicer documentation.</p>
<p>We thought a bit about various ideas that we would love to see in Haddock one way or another. Here is our wish list for all features (some small and some big):</p>
<ul>
<li><p>Automatic code highlight in code sections <code>@ @</code></p></li>
<li><p><a href="https://github.com/haskell/haddock/issues/1049">Expandable sources</a> ‚Äì but this contradicts <a href="https://haskell-haddock.readthedocs.io/en/latest/intro.html">Haddock goals</a>, specifically:</p>
<blockquote>
<p>The documentation should not expose any of the structure of the implementation,</p>
</blockquote></li>
<li><p>Tables with multiline strings and code blocks inside</p></li>
<li><p>Automatic check of all broken links</p></li>
<li><p>Easier way to link to packages from Hackage: you can link to a module or a function by using double or single quotes, but you need to specify the full URL to package on Hackage or Stackage</p></li>
<li><p>Automatic <code>@since</code> annotations. For now, you need to write them manually, but it would be so great if Haddock could calculate the semantic diff between versions and annotate functions automatically. This is something that is already possible with the HIE files. See policeman for the working proof-of-concept.</p></li>
</ul>
<p>These all are non-existing things at the moment, but if you see potential in any of these options, let us know, or even try to push the discussions about them in the <a href="https://github.com/haskell/haddock/issues">Haddock tracker</a>!</p>
<p>We would appreciate that.</p>
<h2 id="conclusion">Conclusion<a href="#conclusion" class="anchor">üîó</a></h2>
<p>Writing documentation is not an easy job. Writing good documentation is much harder than that. But we hope that these notes and tips could help you to improve most easily. You can contribute these enhancements to the libraries that you use, which are needed in some changes to be more friendly or intuitive.</p>
<p>Let‚Äôs not wait for the brighter future, let‚Äôs build it by ourselves!</p>
<h2 id="links">Links<a href="#links" class="anchor">üîó</a></h2>
<ul>
<li><a href="https://haskell-haddock.readthedocs.io/en/latest/">Official Haddock documentation</a></li>
<li><a href="https://github.com/aisamanra/haddock-cheatsheet">Haddock Cheatsheet</a></li>
<li><a href="http://hackage.haskell.org/package/haddock-cheatsheet">Haddock Cheatsheet Package</a></li>
<li><a href="https://artyom.me/haddock-mistakes">Haddock Mistakes</a></li>
<li><a href="https://williamyaoh.com/posts/2019-06-06-how-i-read-haskell-documentation.html">How I read Haskell documentation</a></li>
<li><a href="https://hackage.haskell.org/package/standalone-haddock">Hackage: standalone-haddock</a></li>
</ul>
<h2 id="meme-shelf">Meme shelf<a href="#meme-shelf" class="anchor">üîó</a></h2>
<p><img src="../images/haddock/doc-thor.jpg" alt="Doc Thor" /> <img src="../images/haddock/haddock-xzibit.jpg" alt="Haddock XZibit" /> <img src="../images/haddock/haddock-no-docs.jpg" alt="Think about haddock" /></p>
              </p>
              </div>
          </div>
          </div>
      </div>


      <!-- Bootstrap core JavaScript -->
      <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"> </script>
      <script src="../js/post.js"> </script>
      <script src="../js/hide.js"> </script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>
      <script>hljs.initHighlightingOnLoad()</script>
      <script async defer src="https://buttons.github.io/buttons.js"></script>
  </body>
</html>
