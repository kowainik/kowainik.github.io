<!DOCTYPE html>
<html lang="en">
  <head>
      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-125893749-1"></script>
      <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-125893749-1');
          </script>
    <title>Dhall to HLint: Using Dhall to generate HLint rules :: Kowainik</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Kowainik â€” Creating custom HLint rules for alternative preludes with Dhall">
    <meta name="keywords" content="Haskell, Functional progarmming, FP , haskell, hlint, dhall, prelude ">
    <meta name="author" content="Kowainik  â€” Veronika Romashkina " />

    <!-- Twitter cards -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@kowainik" />
    <meta property="twitter:title" content="Kowainik - Dhall to HLint: Using Dhall to generate HLint rules" />
    <meta name="twitter:description" content="Creating custom HLint rules for alternative preludes with Dhall" />
    <meta name="twitter:image:src" content="https://kowainik.github.io/images/logo-yellow.png" />
    <meta property="og:title" content="Kowainik - Dhall to HLint: Using Dhall to generate HLint rules" />
    <meta property="og:description" content="Creating custom HLint rules for alternative preludes with Dhall" />
    <meta property="og:site_name" content="Kowainik" />
    <meta property="og:image" content="https://kowainik.github.io/images/logo-yellow.png" />

    <!-- Favicon -->
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/dracula.min.css" />
    <!-- Fontawesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <!-- Custom fonts for this template -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Lato" />
    <!-- Custom styles for this template -->
    <link href="../css/default.css" rel="stylesheet">
    <link href="../css/post.css" rel="stylesheet">
  </head>

  <body class="body-posts">

      <!-- Header -->
<nav class="navbar navbar-inverse navbar-fixed-left leftmenu bg-primary text-secondary">
    <div class="navbar-header text-center">
        <div class="postslogo justify-content-center"> <a href="../"><img class="img-fluid" src="../images/logo-tr.png" alt="Kowainik"></a></div>
        <div class="coffee text-center">
            <a class="btn btn-primary rounded-pill" href="https://ko-fi.com/kowainik" target="_blank">
                <i class="fas fa-coffee"></i> Buy a coffee
            </a>
        </div>
        <ul class="socials empty-list list-inline mb-0 justify-content-center text-center mx-auto">
            
            <li class="list-inline-item my-auto">
                <a class="btn btn-outline-dark btn-social text-center rounded-circle" href="https://twitter.com/kowainik" target="_blank">
                    <i class="fab fa-fw fa-twitter"></i>
                </a>
            </li>
            
            <li class="list-inline-item my-auto">
                <a class="btn btn-outline-dark btn-social text-center rounded-circle" href="https://github.com/kowainik" target="_blank">
                    <i class="fab fa-fw fa-github"></i>
                </a>
            </li>
            
            <li class="list-inline-item my-auto">
                <a class="btn btn-outline-dark btn-social text-center rounded-circle" href="https://www.linkedin.com/company/kowainik" target="_blank">
                    <i class="fab fa-fw fa-linkedin"></i>
                </a>
            </li>
            
            <li class="list-inline-item my-auto">
                <a class="btn btn-outline-dark btn-social text-center rounded-circle" href="https://t.me/kowainik" target="_blank">
                    <i class="fab fa-fw fa-telegram"></i>
                </a>
            </li>
            
            <li class="list-inline-item my-auto">
                <a class="btn btn-outline-dark btn-social text-center rounded-circle" href="../rss.xml" target="_blank">
                    <i class="fas fa-fw fa-rss"></i>
                </a>
            </li>
            
        </ul>

    </div>

    <div class="toc-zone justify-content-center">
        <h6 class="coolFont">Contents</h6>
        <div class="toc" id="main">
            <ul>
<li><a href="#motivation">Motivation</a></li>
<li><a href="#why-dhall">Why Dhall</a></li>
<li><a href="#implementation">Implementation</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
        </div>
    </div>
    <div class="allposts text-center">
        <h3><a href="../posts"> Posts =<< </a>
        </h3>
    </div>
</nav>
<div class="container info">
    <h2 class="text-center text-uppercase text-secondary">Dhall to HLint: Using Dhall to generate HLint rules</h2>
    <div class="row coolFont align-self-center justify-content-center">
        <div class="col-10">Date: September  9, 2018</div>
        <div class="col-10">Updated: October 2, 2019</div>

        <div class="author col-10">Author: Veronika Romashkina</div>
        <div class="col-12 text-center m-auto tag-block">
            
            <span class="tag-block"> <a class="btn btn-outline-dark btn-tag" href="../tags/haskell">haskell</a></span>
            
            <span class="tag-block"> <a class="btn btn-outline-dark btn-tag" href="../tags/hlint">hlint</a></span>
            
            <span class="tag-block"> <a class="btn btn-outline-dark btn-tag" href="../tags/dhall">dhall</a></span>
            
            <span class="tag-block"> <a class="btn btn-outline-dark btn-tag" href="../tags/prelude">prelude</a></span>
            
        </div>
    </div>

    <div class="content">
        <div class="row post">
            <div class="col-12 post-body">
                <p class="lead">
                    <p>This short blog post covers the process of creating the <code>.hlint.yaml</code> file from the Dhall configuration. We are using <a href="https://hackage.haskell.org/package/-1.4.0">dhall-json-1.4.0</a> in all following code snippets.</p>
<h2 id="motivation">Motivation<a href="#motivation" class="anchor">ðŸ”—</a></h2>
<p>Letâ€™s first figure out why one could need custom <a href="https://github.com/ndmitchell/hlint">HLint</a> rules. The default HLint settings mostly cover <code>base</code> library. However, nowadays, many people are using alternative preludes. Having <code>.hlint.yaml</code> file specific to the prelude library can help to migrate to the alternative prelude and use it more efficiently.</p>
<p>In Kowainik, we also have our custom prelude â€“ <a href="https://github.com/kowainik/relude"><code>relude</code></a>. <code>relude</code> persues lots of goals such as minimalism, convenience, user-friendliness, etc. We are working a lot to make it pleasant to those who are using it. <code>relude</code> functionality has a few differences from what standard <code>Prelude</code> gives us, which means that not all of the out-of-the-box HLint rules are suitable for us. Thatâ€™s why we need our own rules to provide more information about <code>relude</code> just by running <code>hlint</code> on your project that uses <code>relude</code> as a custom prelude. To show how helpful it could be, I list some use cases for the custom HLint rules below.</p>
<ul>
<li><p><strong>Reexports</strong></p>
<p><code>relude</code> brings common types and functions (from packages like <code>containers</code> and <code>bytestring</code>) into the scope because they are used in almost every application. So we need a way to assist users in getting rid of the redundant imports since <code>GHC</code> canâ€™t warn about such imports. <code>hlint</code> lets us do it with a <code>warn</code> rule. For example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">-</span><span class="at"> </span><span class="fu">warn</span><span class="kw">:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Use 'ByteString' from Relude</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="at">    </span><span class="fu">lhs</span><span class="kw">:</span><span class="at"> Data.ByteString.ByteString</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="at">    </span><span class="fu">rhs</span><span class="kw">:</span><span class="at"> ByteString</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="at">    </span><span class="fu">note</span><span class="kw">:</span><span class="at"> </span><span class="st">'</span><span class="sc">''</span><span class="st">ByteString</span><span class="sc">''</span><span class="st"> is already exported from Relude'</span></span></code></pre></div></li>
<li><p><strong>Lifted functions</strong></p>
<p>In <code>relude</code> a lot of <code>IO</code> functions are lifted to <code>MonadIO</code> for the convenience. All similar HLint suggestions have the following structure:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">-</span><span class="at"> </span><span class="fu">warn</span><span class="kw">:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">'</span><span class="sc">''</span><span class="st">liftIO</span><span class="sc">''</span><span class="st"> is not needed'</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="at">    </span><span class="fu">lhs</span><span class="kw">:</span><span class="at"> liftIO (print x)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="at">    </span><span class="fu">rhs</span><span class="kw">:</span><span class="at"> print x</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="at">    </span><span class="fu">note</span><span class="kw">:</span><span class="at"> If you import 'print' from Relude, it's already lifted</span></span></code></pre></div></li>
<li><p><strong>Relude specific rules</strong></p>
<p>We also would like to encourage people to make the code more efficient and clear. In <code>relude</code> we introduced some functions with the improved performance comparing to the <code>base</code> analogues. For instance, with the following rule, you can perform much faster nubbing:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">-</span><span class="at"> </span><span class="fu">warn</span><span class="kw">:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="at">    </span><span class="fu">lhs</span><span class="kw">:</span><span class="at"> nub</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="at">    </span><span class="fu">rhs</span><span class="kw">:</span><span class="at"> ordNub</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="at">    </span><span class="fu">note</span><span class="kw">:</span><span class="at"> </span><span class="st">'</span><span class="sc">''</span><span class="st">nub</span><span class="sc">''</span><span class="st"> is O(n^2), </span><span class="sc">''</span><span class="st">ordNub</span><span class="sc">''</span><span class="st"> is O(n log n)'</span></span></code></pre></div></li>
<li><p><strong>Ignoring</strong></p>
<p>Also, as we are constructing a renewed interface, not all <code>base</code> rules are suitable. Consequently, we need to ignore some of them:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="co"># `relude` doesn't export untotal `head`.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="kw">-</span><span class="at"> </span><span class="fu">ignore</span><span class="kw">:</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Use head</span></span></code></pre></div></li>
<li><p><strong>Hints</strong></p>
<p>Users might not want to perform all changes we suggest, so instead of <code>warn</code>s we can offer <code>hint</code>s on some less significant rules:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">-</span><span class="at"> </span><span class="fu">hint</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="at">    </span><span class="fu">lhs</span><span class="kw">:</span><span class="at"> (fmap and (sequence s))</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="at">    </span><span class="fu">rhs</span><span class="kw">:</span><span class="at"> andM s</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="at">    </span><span class="fu">note</span><span class="kw">:</span><span class="at"> Applying this hint would mean that some actions that were being</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a><span class="at">          executed previously would no longer be executed.</span></span></code></pre></div></li>
</ul>
<p>To summarise everything said before, we have to write a lot of boilerplate to cover all these rules which we (as lazybones) would like to avoid at all costs. Moreover, the maintenance price is quite high for thousands of lines of <code>yaml</code>.</p>
<h2 id="why-dhall">Why Dhall<a href="#why-dhall" class="anchor">ðŸ”—</a></h2>
<p>As the tool that can help us with removing boilerplate, we have chosen <a href="https://github.com/dhall-lang/dhall-lang">Dhall language</a>. As reference:</p>
<blockquote>
<p>Dhall is a programmable configuration language that is not Turing-complete. You can think of Dhall as: JSON + functions + types + imports</p>
</blockquote>
<p>This sounds like pretty much what we need.</p>
<p>You may wonder why we are not using <code>Haskell</code> for such purposes (though we love it so much â™¥). The answer is that we donâ€™t need <code>IO</code> capabilities for our problem; totality and safety of Dhall are enough here. Changing the configuration in Haskell requires to recompile the whole program before generating config, but with Dhall thereâ€™s no such extra step. Not to mention fantastic string interpolation that Dhall has. Also, we wanted to familiarise ourselves with the new technologies, and this seemed like an excellent opportunity to dive into Dhall.</p>
<h2 id="implementation">Implementation<a href="#implementation" class="anchor">ðŸ”—</a></h2>
<p>Basically, HLint file is just a list of different kind of rules. List in Dhall should consist of the elements of the same type (because Dhall is a typed configuration language), but, as youâ€™ve seen, we need to use <code>warn</code>, <code>ignore</code>, <code>hint</code> and other rules. To unify different rule types with the same type, we can create a sum type in Dhall. Here how you do it (this is the <code>hlint/Rule.dhall</code>]<a href="https://github.com/kowainik/relude/blob/main/hlint/Rule.dhall">Rule</a> file):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="op">&lt;</span> <span class="dt">Arguments</span> <span class="op">:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>    { arguments <span class="op">:</span> <span class="dt">List</span> <span class="dt">Text</span> }</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a><span class="op">|</span> <span class="dt">Ignore</span> <span class="op">:</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>    { ignore <span class="op">:</span> {name <span class="op">:</span> <span class="dt">Text</span>} }</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a><span class="op">|</span> <span class="dt">Warn</span> <span class="op">:</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>    { warn <span class="op">:</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>        { name <span class="op">:</span> <span class="dt">Optional</span> <span class="dt">Text</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a>        , lhs  <span class="op">:</span> <span class="dt">Text</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>        , rhs  <span class="op">:</span> <span class="dt">Text</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a>        , note <span class="op">:</span> <span class="dt">Optional</span> <span class="dt">Text</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a>        }</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a>    }</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a><span class="op">|</span> <span class="dt">Hint</span> <span class="op">:</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a>    { hint <span class="op">:</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a>        { lhs  <span class="op">:</span> <span class="dt">Text</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a>        , rhs  <span class="op">:</span> <span class="dt">Text</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a>        , note <span class="op">:</span> <span class="dt">Optional</span> <span class="dt">Text</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a>        }</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true"></a>    }</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true"></a><span class="op">&gt;</span></span></code></pre></div>
<p>This type might look like this in <code>Haskell</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="kw">data</span> <span class="dt">Rule</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>    <span class="ot">=</span> <span class="dt">RuleArguments</span> <span class="dt">Arguments</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>    <span class="op">|</span> <span class="dt">RuleIgnore</span> <span class="dt">Ignore</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>    <span class="op">|</span> <span class="dt">RuleWarn</span> <span class="dt">Warn</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>    <span class="op">|</span> <span class="dt">RuleHint</span> <span class="dt">Hint</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a><span class="kw">newtype</span> <span class="dt">Arguments</span> <span class="ot">=</span> <span class="dt">Args</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a>    {<span class="ot"> arguments ::</span> [<span class="dt">Text</span>]</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a>    }</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a><span class="kw">newtype</span> <span class="dt">Ignore</span> <span class="ot">=</span> <span class="dt">Ignore</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true"></a>    {<span class="ot"> ignore ::</span> <span class="dt">Name</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true"></a>    }</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true"></a><span class="kw">newtype</span> <span class="dt">Name</span> <span class="ot">=</span> <span class="dt">Name</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true"></a>    {<span class="ot"> name ::</span> <span class="dt">Text</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true"></a>    }</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true"></a><span class="kw">newtype</span> <span class="dt">Warn</span> <span class="ot">=</span> <span class="dt">Warn</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true"></a>    {<span class="ot"> warn ::</span> <span class="dt">Wrn</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true"></a>    }</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true"></a><span class="kw">data</span> <span class="dt">Wrn</span> <span class="ot">=</span> <span class="dt">Wrn</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true"></a>    {<span class="ot"> name ::</span> <span class="dt">Maybe</span> <span class="dt">Text</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true"></a>    ,<span class="ot"> lhs  ::</span> <span class="dt">Text</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true"></a>    ,<span class="ot"> rhs  ::</span> <span class="dt">Text</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true"></a>    ,<span class="ot"> note ::</span> <span class="dt">Maybe</span> <span class="dt">Text</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true"></a>    }</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true"></a><span class="kw">newtype</span> <span class="dt">Hint</span> <span class="ot">=</span> <span class="dt">Hint</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true"></a>    {<span class="ot"> hint ::</span> <span class="dt">Hnt</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true"></a>    }</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true"></a><span class="kw">data</span> <span class="dt">Hnt</span> <span class="ot">=</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true"></a>    {<span class="ot"> lhs  ::</span> <span class="dt">Text</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true"></a>    ,<span class="ot"> rhs  ::</span> <span class="dt">Text</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true"></a>    ,<span class="ot"> note ::</span> <span class="dt">Maybe</span> <span class="dt">Text</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true"></a>    }</span></code></pre></div>
<p>Since weâ€™ve introduced the main <code>Rule</code> type, we should create functions for adding rules. Iâ€™m going to explain it on one example for the reexport warnings. The rest can be found in <a href="https://github.com/kowainik/relude/blob/main/hlint/warn.dhall"><code>hlint/warn.dhall</code></a>.</p>
<p>We need to implement a Dhall function that takes a type name for which we are applying the rule and the module from which people can export it because they donâ€™t know that itâ€™s already in <code>relude</code>, and we expect this function to output the HLint warning about the redundant import.</p>
<p>Letâ€™s try to do this. Talking in Haskell syntax, we need a function like <code>warnReexport :: Text -&gt; Text -&gt; Rule</code> (in our case, the rule is <code>RuleWarn</code>). Letâ€™s write the similar one in Dhall.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="co">-- import Rule type</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="kw">let</span> <span class="dt">Rule</span> <span class="ot">=</span> <span class="op">./</span>Rule.dhall</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a><span class="co">-- get all constructors of `Rule`, so we can refer to it as `rule.Warn` etc.</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a><span class="kw">let</span> warnReexport</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>    <span class="op">:</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">Rule</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>    <span class="ot">=</span> \(f <span class="op">:</span> <span class="dt">Text</span>) <span class="ot">-&gt;</span> \(<span class="fu">mod</span> <span class="op">:</span> <span class="dt">Text</span>) <span class="ot">-&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>        <span class="co">-- using our constructor to create the `Warn`</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>        <span class="dt">Rule.Warn</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>        { warn <span class="ot">=</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>            { name <span class="ot">=</span> <span class="dt">Some</span> <span class="st">&quot;Use '${f}' from Relude&quot;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>            , lhs <span class="ot">=</span> <span class="st">&quot;${mod}.${f}&quot;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a>            , rhs <span class="ot">=</span> <span class="st">&quot;${f}&quot;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true"></a>            , note <span class="ot">=</span> <span class="dt">Some</span> <span class="st">&quot;'${f}' is already exported from Relude&quot;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true"></a>            }</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true"></a>        }</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true"></a><span class="kw">in</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true"></a>    { warnReexport <span class="ot">=</span> warnReexport</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true"></a>    , <span class="op">...</span> <span class="co">-- here we have other functions</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true"></a>    }</span></code></pre></div>
<p>And, the most important part is how actually this function is used. Letâ€™s look at <a href="https://github.com/kowainik/relude/blob/main/hlint/hlint.dhall"><code>hlint/hlint.dhall</code></a>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="co">-- import functions from previous file</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="kw">let</span> warn           <span class="ot">=</span> <span class="op">./</span>warn<span class="op">.</span>dhall</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="co">-- reassign function</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a><span class="kw">let</span> warnReexport   <span class="ot">=</span> warn<span class="op">.</span>warnReexport</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a><span class="kw">in</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>    [ warnReexport <span class="st">&quot;ByteString&quot;</span> <span class="st">&quot;Data.ByteString&quot;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>    , warnReexport <span class="st">&quot;Text&quot;</span> <span class="st">&quot;Data.Text&quot;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a>    <span class="op">...</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a>    ]</span></code></pre></div>
<p>So with such rules, users would be getting a warning when they import <code>ByteString</code> from <code>Data.ByteString</code> module of <code>base</code> instead of omitting it in favour of the <code>relude</code> exports.</p>
<p>And in such manner, we could create functions and build all other rules, pretty easy.</p>
<p>Now, the only thing left is to generate <code>.hlint.yaml</code> from <code>hlint.dhall</code>. To do so, you can run the following command (you need to have <a href="https://hackage.haskell.org/package/dhall-json"><code>dhall-json</code></a> installed):</p>
<pre class="shell"><code>$  dhall-to-yaml --omitNull &lt;&lt;&lt; './hlint/hlint.dhall' &gt; .hlint.yaml</code></pre>
<h2 id="conclusion">Conclusion<a href="#conclusion" class="anchor">ðŸ”—</a></h2>
<p>The process of creating <code>Dhall</code> modules was not very painful, so we can consider the experiment successful, and we are going to maintain the <code>.hlint.yaml</code> using our <code>hlint.dhall</code> configuration. Now, adding additional rule <em>is just one line</em>, and itâ€™s much easier to refactor configuration!</p>
<p>Here is the table of file size comparison in different formats to show you how many keystrokes we managed to avoid.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th><strong>.hlint.yaml</strong></th>
<th><strong>hlint.dhall</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Lines</td>
<td>3086</td>
<td>1019</td>
</tr>
</tbody>
</table>
                </p>
            </div>
        </div>

    </div>
</div>
<footer class="footer text-center">
    <div class="row">
        <div class="col-12 post-body">
            <hr class="star-light">
        </div>
    </div>
    <div class="row justify-content-center flex-row">
        <div class="col-md-4 mb-5 mb-lg-0">
            <div class="stretch">
                <h4 class="text-uppercase mt-0 mb-4 flex-h">Support our work</h4>
                <p class="px-5 flex-text flex-txt">If you like what we do, you can help us do more of that by supporting
                    on Ko-Fi or GitHub:</p>
                <ul class="empty-list list-inline mb-0 mx-auto flex-links">
                    <li class="list-inline-item my-auto">
                        <a class="btn btn-outline-primary btn-sm rounded-pill" href="https://ko-fi.com/kowainik" target="_blank">
                            <i class="fas fa-coffee"></i> Buy a coffee
                        </a>

                    </li>
                    <li class="list-inline-item my-auto">
                        <a class="btn btn-outline-primary btn-sm rounded-pill" href="https://github.com/sponsors/vrom911" target="_blank">
                            <i class="fab fa-github"></i> @vrom911
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="col-md-4 mb-5 mb-lg-0">
            <div class="stretch">
                <h4 class="text-uppercase text-center mb-4 footer-h">Subscribe</h4>
                <p class="px-5 flex-text footer-txt">Enjoyed this post? Consider subscribing to our newsletter to always
                    be first to check out our new updates:</p>
                <!-- Begin Mailchimp Signup Form -->
                <div class="footer-links"> <div class="row justify-content-center subscribe-form" id="mc_embed_signup">
  <form action="https://news.us2.list-manage.com/subscribe/post?u=af5d0411175f11e83618abf5e&amp;id=b04a7ed805" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div class="form-row mx-0" id="mc_embed_signup_scroll">
      <div class="col-8 input-group ">
        <div class="input-group-prepend">
          <div class="input-group-text"><i class="fa fa-envelope"></i> </div>
        </div>
        <input type="email" value name="EMAIL" class="required email form-control" placeholder="Your email" id="mce-EMAIL">
      </div>
      <div class="col-4 text-left">
        <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button btn btn-primary btn-lg">
      </div>
      <div class="mc-field-group group-checkbox input-group">
        <ul>
          <li><input type="checkbox" value="1" name="group[83780][1]" class="form-check-input" id="mce-group[83780]-83780-0"></li>
          <li><input type="checkbox" value="2" name="group[83780][2]" class="form-check-input" id="mce-group[83780]-83780-1" checked></li>
        </ul>
      </div>
      <div id="mce-responses" class="clear">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
      </div>
      <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_af5d0411175f11e83618abf5e_b04a7ed805" tabindex="-1" value></div>
    </div>
  </form>
</div>
</div>
                <!--End mc_embed_signup-->
            </div>
        </div>
        <div class="col-md-4 mb-5 mb-lg-0">
            <div class="stretch">
                <h4 class="text-uppercase mb-4 footer-h">Follow us</h4>
                <p class="px-5 footer-txt mt-6">We also share our work elsewhere. You can find us also at:</p>
                <ul class="empty-list list-inline mb-0 mx-auto text-center footer-links">
                    
                    <li class="list-inline-item my-auto">
                        <a class="btn btn-outline-light btn-social text-center rounded-circle" href="https://twitter.com/kowainik" target="_blank">
                            <i class="fab fa-fw fa-twitter"></i>
                        </a>
                    </li>
                    
                    <li class="list-inline-item my-auto">
                        <a class="btn btn-outline-light btn-social text-center rounded-circle" href="https://github.com/kowainik" target="_blank">
                            <i class="fab fa-fw fa-github"></i>
                        </a>
                    </li>
                    
                    <li class="list-inline-item my-auto">
                        <a class="btn btn-outline-light btn-social text-center rounded-circle" href="https://www.linkedin.com/company/kowainik" target="_blank">
                            <i class="fab fa-fw fa-linkedin"></i>
                        </a>
                    </li>
                    
                    <li class="list-inline-item my-auto">
                        <a class="btn btn-outline-light btn-social text-center rounded-circle" href="https://t.me/kowainik" target="_blank">
                            <i class="fab fa-fw fa-telegram"></i>
                        </a>
                    </li>
                    
                    <li class="list-inline-item my-auto">
                        <a class="btn btn-outline-light btn-social text-center rounded-circle" href="../rss.xml" target="_blank">
                            <i class="fas fa-fw fa-rss"></i>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </div>
</footer>

      <!-- Bootstrap core JavaScript -->
      <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"> </script>
      <script src="../js/post.js"> </script>
      <script src="../js/hide.js"> </script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>
      <script>hljs.initHighlightingOnLoad()</script>
      <script async defer src="https://buttons.github.io/buttons.js"></script>
  </body>
</html>
